---
- name: Listen for events on a webhook
  hosts: all

  sources:
    - ansible.eda.webhook:
        host: 0.0.0.0
        port: 5000
      filters:
      - ansible.eda.insert_hosts_to_meta:
          host_path: "payload.hosts"

  rules:
    - name: Collect information
      condition: event.payload.action == "collect_information"
      action:
        run_playbook:
          name: playbooks/collect_information.yml

    - name: Force fsck on boot
      condition: event.payload.action == "fsck"
      action:
        run_playbook:
          name: playbooks/fsck.yml
